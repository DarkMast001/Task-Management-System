# Система управления задачами с использованием очередей

## Описание проекта

Проект представляет собой систему управления задачами, где задачи добавляются в очередь и выполняются рабочими процессами. Реализованы следующие функции:

- Добавление задач c приоритетами в очередь
- Извлечение задач из очереди рабочими процессами для выполнения
- Синхронизация доступа к очереди с использованием механизма потокобезопасности (ManualResetEventSlim)

## Архитектура проекта

### Модуль `Task-generator-system`.

**Класс `TaskGenerator`** используется для генерации задач на основе заданных параметров. Он предоставляет методы для создания списка задач, которые могут быть выполнены рабочими процессами.

**Основные функции**:

- Генерация задач:
  - Создаёт список задач (`PriorityTask`) с случайными приоритетами и временем выполнения.
  - Учитывает вероятность прерывания задачи (задача может быть отменена с определённой вероятностью).
- Сериализация данных:
  - Поддерживает десериализацию данных из JSON-формата с помощью метода `TryCreate`. Это позволяет принимать данные от клиента через TCP-соединение.
- Параметры задач:
  - Количество задач.
  - Вероятность прерывания задачи (в процентах).
  - Минимальное и максимальное время выполнения задачи (в миллисекундах).

**Класс `PriorityTask`** представляет одну задачу с определённым приоритетом и временем выполнения.

**Основные свойства**:

- `Priority`: Приоритет задачи (чем выше значение, тем выше приоритет).
- `Id`: Уникальные идентификатор задачи.

**Основные методы:**

- `Execute`: Выполняет задачу. Если задача должна быть прервана, выбрасывается исключение `OperationCanceledException`.
- Логирование: Выводит информацию о начале, завершении или прерывании задачи в консоль.

**TCP клиент**

Модуль включает функционал для отправки данных о задачах на сервер через TCP-соединение.

**Интерфейс командной строки**

Модуль предоставляет интерфейс командной строки для взаимодействия с пользователем. Доступны следующие команды:

- `mkgen`: Создать новый описатель задач.
- `checkgen`: Вывести информацию о текущем описателе задач.
- `setsocket`: Задать IP-адрес и порт сервера.
- `send`: Отправить описатель задач на сервер.
- `benchmark`: Провести бенчмарк-тест.
- `delgen`: Удалить текущий описатель задач.
- `exit`: Выйти из программы.

---

### Модуль `Shaduler-and-processor-system`.

Модуль `Shaduler-and-processor-system` отвечает за управление задачами, их распределение между рабочими процессами и выполнение. Он включает два файла: основной класс Shaduler и программный файл Program, который реализует TCP-сервер для обработки входящих подключений и задач.

**Класс `Shaduler`** является центральным компонентом модуля и отвечает за управление очередью задач, запуск рабочих процессов и синхронизацию доступа к данным.

**Основные функции**:

- Очередь задач:
  - Задчи организованы в очередь по приоритетам (`SortedList<int, ConcurrentQueue<PriorityTask>>`).
  - Задачи с более высоким приоритетом выполняются раньше.
- Рабочие процессы:
  - Рабочие процессы создаются в количестве, указанном пользователем.
  - Каждый рабочий процесс извлекает задачи из очереди и выполняет их.
- Синхронизация доступа:
  - Используется механизм lock для обеспечения потокобезопасного доступа к очереди задач.
  - Для уведомления рабочих процессов о новых задачах используется ManualResetEventSlim.
- Обработка ошибок:
  - Поддерживается отмена задач с помощью исключения OperationCanceledException.
- Вывод информации:
  - Выводится информация о выполнении задач (время выполнения, количество задач).

**Основные поля и свойства**:

- `_queues`: Хранит задачи, организованные по приоритетам.
- `_lock`: Обеспечивает потокобезопасный доступ к очереди задач.
- `_isProcessorWork`: Флаг, указывающий, был ли вызван метод StartProcessorWork.
- `_countWorkers`: Количество рабочих процессов.
- `_stopWatch`: Таймер для замера времени выполнения задач.
- `_taskAvailable`: Механизм синхронизации для уведомления рабочих процессов о новых задачах.
- `_waitingThreads`: Количество потоков, находящихся в состоянии ожидания.
- `_userSocket`: Сокет текущего подключённого пользователя.
- `_countOfTasks`: Общее количество задач в очереди.

**Основные методы**:

1. `Enqueu(PriorityTask task)`: Добавляет задачу в очередь. Если очередь была пуста, запускает таймер. Уведомляет рабочие процессы о появлении новой задачи.
2. `Dequeue()`: Извлекает задачу с наивысшим приоритетом из очереди. Если очередь пуста, возвращает `null`.
3. `StartProcessorWork()`: Запускает рабочие процессы в количестве, указанном пользователем. Каждый рабочий процесс выполняет метод `CompleteTask`.
4. `CompleteTask(object? message)`: Метод, выполняемый каждым рабочим процессом. Извлекает задачи из очереди и выполняет их. Если задачи отсутствуют, переводит поток в состояние ожидания.
5. `ClearTasks()`: Очищает очередь задач.
6. `ToString()`: Возвращает строковое представление очереди задач (приоритеты и ID задач).

**Файл `Program`** реализует реализует TCP-сервер для обработки входящих подключений и задач. Он взаимодействует с классом `Shaduler` для добавления задач в очередь и их выполнения.

**Основные функции**:

1. TCP-сервер:
   - Сервер принимает подключения клиентов и данные о задачах.
   - Данные десериализуются в объект `TaskGenerator`, который преобразуется в список задач и добавляется в очередь.
2. Обработка очереди пользователей:
   - Подключённые пользователи помещаются в очередь (userQueue).
   - Поток `ProcessQueue` извлекает пользователей из очереди и обрабатывает их задачи.
3. Логирование:
   - Выводится информация о подключении пользователей и обработке задач.

---

### Модуль `TaskDescriptor`.

**Класс `TaskDescriptor`** используется для описания параметров задач, которые будут созданы. Этот класс сериализуется в JSON-формат для передачи данных по TCP.

**Основные свойства**:

- `AmountOfTasks`: Количество задач.
- `InterruptionChance`: Вероятность прерывания задачи (в процентах).
- `MinExecutionTimeInMilliseconds`: Минимальное время выполнения задачи (в миллисекундах).
- `MaxExecutionTimeInMilliseconds`: Максимальное время выполнения задачи (в миллисекундах).

## Как запустить проект

1. Склонируйте репозиторий:<br>
   `git clone https://github.com/DarkMast001/Task-Management-System.git`<br>
2. Перейдите в папку `Shaduler-and-processor-system/bin/Debug/net8.0`.
   Тут вы найдёте 2 необходимых `exe` файла:<br>
   - `Shaduler-and-processor-system.exe`: серверный `exe` файл. Он отвечает за загрузу шедулера, выступает в роли "приёмщика" задач.
   - `Task-generator-system.exe`: клиентский `exe` файл. На нём формируются описатели задач и происходит отправка их на сервер. Может быть запущено несколько одновременно.
